# 题意

 令 $f(i)$ 为 $i$ 的正因子个数，求 $\sum_{i=1}^nf(i)$ 的值

 $n \leq 10^{12}$

# 部分分解法

 - ## 暴力

   枚举 $[1,n]$ 内所有数的因数，

   ``` C++
    long long ans=0;
    for(int i=1;i<=n;i++){
        for(int j=1;j*j<=i;j++){
            if(i%j==0){
                ans++;
            }
        }
    }
   ```

   复杂度$O(\sum_{i=1}^n\sqrt i)$,二阶近似为 $O(\frac{2}{3}n^{\frac{3}{2}}+\frac{1}{2}\sqrt n)$

   如果利用以下性质 $O(n)$ 线性筛预处理质数还可以更快一丢丢
  
   $$
     \begin{align*}
     \text{}
     & x=\prod_{i=1}^c p_i^{a_i}\\
     & \forall i :p_i \in \mathbb{P},a_i \in \mathbb{N}\\
     & f(x)=\prod_{i=1}^c (1+a_i)\\
     \end{align*}
   $$

   ``` C++
     long long ans=1;
     for(int i=1;i<=n;i++){
         for(int j:prime){
             if(j>i){
                 break
             }
             if(i%j==0){
                 int cnt=1;
                 while(i%j==0&&i>0){
                     i/=j;
                     cnt++;
                 }
                 ans*=cnt;
             } 
         } 
      }
   ```

   由于 $[1,n]$ 内质数的个数约 $\frac{n}{\ln n}$ 所以复杂度为 $O(\frac{n^2}{\ln n})$

 - ## $O(n)$ 暴力

   考虑 $k$ 对答案的贡献,易得
   $$
    \begin{align*}
    ans=\sum_{i=1}^n f(i)=\sum_{k=1}^n \lfloor \frac{n}{k} \rfloor\\
    \end{align*}
    $$

   ```C++
     long long ans=0;
     for(int k=1;k<=n;k++){
         ans+=(n/k);
      }
  
   ```

# 正解
  当 $n=10$ 时
 
  观察并列出$O(n)$ 暴力中每个 $k$ 的贡献:
 
  $$
  \begin{matrix}
   10 & 5 & 3 & 2 & 2 & 1 & 1 & 1 & 1 & 1
  \end{matrix}
  $$

  发现：有大段重复数据

  因此我们只需要计算某段贡献的长度与贡献就可以减少大量计算

  令 $l,r$ 为贡献相同的区间的左右端点

  易得 $r=\lfloor \frac{n}{\lfloor \frac{n}{l} \rfloor}\rfloor$ 而下一个区间的右端点则为 $r+1$ 

  ```C++
  for(int l=1,r;l<=n;l=r+1){
      r=n/(n/l);
      ans+=(r-l+1)*(n/l);
  }
  ```
  估测循环次数小于 $2 \sqrt n$,复杂度 $O(\sqrt n)$

2026.2.17